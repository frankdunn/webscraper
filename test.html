<html lang="en"><head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="css/bootstrap.min.css" rel="stylesheet">

	<title>SpectroDashboard</title>

	<script src="js/jquery-3.2.1.min.js"></script>
	<script src="js/bootstrap.bundle.min.js"></script>
</head>
<body class="font-weight-bold">

<div class="alert alert-danger" id="banner-alert" role="alert" style="display: none;"></div>

<table class="table table-striped">
	<thead>
	<tr id="table-header-row" style="font-size: 1.7em;"><th scope="col">TimeStamp</th><th scope="col">Sample Name</th><th scope="col">Furnace</th><th scope="col">C</th><th scope="col">Si</th><th scope="col">Mn</th><th scope="col">P</th><th scope="col">S</th><th scope="col">Cu</th><th scope="col">Cr</th><th scope="col">Al</th><th scope="col">Ti</th><th scope="col">Sn</th><th scope="col">Zn</th><th scope="col">Pb</th></tr>
	</thead>
	<tbody id="table-body" style="font-size: 1.5em;"><tr><td>?20?/?11?/?2018? ?14?:?19?:?37</td><td>1215</td><td>472 AT</td><td>3.240</td><td>1.929</td><td>0.638</td><td>0.028</td><td>0.085</td><td>0.556</td><td>0.266</td><td>0.004</td><td>0.014</td><td>0.051</td><td>0.002</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?14?:?10?:?31</td><td>205 REGRIND</td><td>HF2</td><td>3.240</td><td>1.870</td><td>0.636</td><td>0.029</td><td>0.091</td><td>0.559</td><td>0.269</td><td>0.003</td><td>0.015</td><td>0.050</td><td>0.003</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?14?:?03?:?12</td><td>205</td><td>HF2</td><td>3.240</td><td>1.884</td><td>0.637</td><td>0.030</td><td>0.091</td><td>0.557</td><td>0.270</td><td>0.003</td><td>0.015</td><td>0.083</td><td>0.003</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?13?:?58?:?10</td><td>103</td><td>ABB3</td><td>2.940</td><td>1.631</td><td>0.697</td><td>0.026</td><td>0.740</td><td>0.156</td><td>0.156</td><td>0.002</td><td>0.009</td><td>0.046</td><td>0.004</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?13?:?51?:?05</td><td>1185</td><td>472 AT</td><td>3.230</td><td>1.911</td><td>0.649</td><td>0.030</td><td>0.084</td><td>0.556</td><td>0.263</td><td>0.005</td><td>0.014</td><td>0.047</td><td>0.002</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?13?:?46?:?29</td><td>8C</td><td>STD</td><td>3.396</td><td>1.931</td><td>0.408</td><td>0.163</td><td>0.058</td><td>0.160</td><td>0.127</td><td>0.003</td><td>0.022</td><td>0.066</td><td>0.000</td><td>0.007</td></tr><tr><td>?20?/?11?/?2018? ?13?:?45?:?26</td><td>245B</td><td>STD</td><td>3.279</td><td>1.593</td><td>1.385</td><td>0.413</td><td>0.036</td><td>0.082</td><td>0.197</td><td>0.036</td><td>0.110</td><td>0.076</td><td>0.000</td><td>0.024</td></tr><tr><td>?20?/?11?/?2018? ?13?:?00?:?42</td><td>303</td><td>ABB3</td><td>2.930</td><td>1.444</td><td>0.594</td><td>0.027</td><td>0.095</td><td>0.138</td><td>0.210</td><td>0.003</td><td>0.012</td><td>0.045</td><td>0.010</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?12?:?51?:?19</td><td>1155</td><td>472 AT</td><td>3.220</td><td>1.931</td><td>0.667</td><td>0.030</td><td>0.088</td><td>0.559</td><td>0.272</td><td>0.004</td><td>0.015</td><td>0.051</td><td>0.002</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?12?:?49?:?21</td><td>204</td><td>HF2</td><td>3.280</td><td>1.792</td><td>0.653</td><td>0.029</td><td>0.081</td><td>0.554</td><td>0.264</td><td>0.002</td><td>0.014</td><td>0.051</td><td>0.002</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?12?:?36?:?07</td><td>403</td><td>ABB4</td><td>3.220</td><td>2.281</td><td>0.621</td><td>0.028</td><td>0.094</td><td>0.264</td><td>0.283</td><td>0.001</td><td>0.012</td><td>0.056</td><td>0.004</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?12?:?10?:?55</td><td>102F</td><td>ABB1</td><td>3.270</td><td>1.609</td><td>0.628</td><td>0.026</td><td>0.068</td><td>0.518</td><td>0.265</td><td>0.005</td><td>0.011</td><td>0.044</td><td>0.006</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?11?:?56?:?11</td><td>1125</td><td>472 AT</td><td>3.220</td><td>2.000</td><td>0.681</td><td>0.028</td><td>0.086</td><td>0.563</td><td>0.282</td><td>0.004</td><td>0.014</td><td>0.052</td><td>0.002</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?11?:?27?:?22</td><td>201</td><td>ABB2</td><td>3.300</td><td>1.770</td><td>0.602</td><td>0.031</td><td>0.089</td><td>0.185</td><td>0.210</td><td>0.001</td><td>0.013</td><td>0.040</td><td>0.002</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?11?:?25?:?31</td><td>102</td><td>ABB1</td><td>2.610</td><td>1.155</td><td>0.517</td><td>0.024</td><td>0.032</td><td>0.157</td><td>0.169</td><td>0.004</td><td>0.009</td><td>0.036</td><td>0.008</td><td>0.002</td></tr><tr><td>?20?/?11?/?2018? ?11?:?13?:?24</td><td>302F</td><td>ABB3</td><td>3.240</td><td>1.654</td><td>0.516</td><td>0.029</td><td>0.093</td><td>0.148</td><td>0.200</td><td>0.004</td><td>0.014</td><td>0.047</td><td>0.000</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?11?:?04?:?08</td><td>203</td><td>HF2</td><td>3.180</td><td>1.929</td><td>0.690</td><td>0.026</td><td>0.088</td><td>0.559</td><td>0.286</td><td>0.002</td><td>0.014</td><td>0.045</td><td>0.002</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?10?:?22?:?42</td><td>402</td><td>ABB4</td><td>2.960</td><td>1.954</td><td>0.679</td><td>0.027</td><td>0.088</td><td>0.159</td><td>0.295</td><td>0.005</td><td>0.012</td><td>0.049</td><td>0.006</td><td>0.002</td></tr><tr><td>?20?/?11?/?2018? ?10?:?19?:?14</td><td>1095</td><td>472 AT</td><td>3.210</td><td>1.934</td><td>0.680</td><td>0.028</td><td>0.085</td><td>0.566</td><td>0.277</td><td>0.003</td><td>0.014</td><td>0.045</td><td>0.002</td><td>0.001</td></tr><tr><td>?20?/?11?/?2018? ?09?:?50?:?03</td><td>302</td><td>ABB3</td><td>3.722</td><td>1.856</td><td>0.570</td><td>0.030</td><td>0.110</td><td>0.170</td><td>0.225</td><td>0.002</td><td>0.016</td><td>0.052</td><td>0.001</td><td>0.001</td></tr></tbody>
</table>

<script>
	var populateTable = function(res) {
        // Header
        if (res.length > 0) {
            if (res[0].results.length > 0) {
                var tblHeadings = '<th scope="col">TimeStamp</th><th scope="col">Sample Name</th><th scope="col">Furnace</th>';
                for (var i = 0; i < res[0].results.length; i++) {
                    tblHeadings += '<th scope="col">' + res[0].results[i].element + '</th>';
                }
                $("#table-header-row").html(tblHeadings);
            }
        }

        // Body
        $("#table-body").empty();
        for (var i = 0; i < res.length; i++) {
            var tblDataRow =
                '<tr><td>' + (new Date(res[i].time_stamp)).toLocaleString('en-GB') + '</td>'
                + '<td>' + res[i].sample_name + '</td>'
                + '<td>' + res[i].furnace + '</td>';
            for (var j = 0; j < res[i].results.length; j++) {
                tblDataRow += '<td>' + parseFloat(Math.round(res[i].results[j].value * 1000) / 1000).toFixed(3) + '</td>';
            }
            tblDataRow += '</tr>';
            $("#table-body").append(tblDataRow);
        }
	};

	var getResults = function() {
        $.get("results")
			.done(function(res) {
                $("#banner-alert").hide();
				populateTable(res);
			})
			.fail(function(err) {
				console.error(err);
                $("#table-header-row").empty();
                $("#table-body").empty();
                if (err.readyState === 0) {
                    // browser unable to open tcp connection.
					var dst = window.location.protocol + "//" + window.location.hostname + (window.location.port ? ':' + window.location.port: '');
                    $("#banner-alert").html('Unable to make connection to server "' + dst + '"')
				} else {
                    $("#banner-alert").html(err.responseText);
				}
                $("#banner-alert").show();
			});
	};

	// Init
	$(function() {
        getResults();
	    setInterval(getResults, 10000);
	});
</script>


</body></html>